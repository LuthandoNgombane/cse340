<% if (title) { %>
    <h1><%= title %></h1>
<% } else { %>
    <script>window.location.href = '/'</script>
<% } %>

<%- grid %>

<div class="review-container">
    <hr>
    <section id="reviews">
        <h2>Customer Reviews</h2>
        <% if (reviews && reviews.length > 0) { %>
            <ul class="review-list">
                <% reviews.forEach(review => { %>
                    <li>
                        <strong><%= review.account_firstname %> <%= review.account_lastname %></strong> 
                        on <%= new Date(review.review_date).toLocaleDateString() %>:
                        <p><%= review.review_text %></p>
                    </li>
                <% }) %>
            </ul>
        <% } else { %>
            <p class="notice">Be the first to review this vehicle!</p>
        <% } %>
    </section>

    <section id="add-review">
        <h3>Write a Review</h3>
        <% if (locals.loggedin) { %>
            <form action="/review/add" method="post" class="standard-form">
                <label for="review_text">What did you think of this <%= title %>?</label>
                <textarea id="review_text" name="review_text" required rows="5" placeholder="Enter your review here..."></textarea>
                
                <input type="hidden" name="inv_id" value="<%= vehicle.inv_id %>">
                <input type="hidden" name="account_id" value="<%= locals.accountData.account_id %>">
                
                <button type="submit">Post Review</button>
            </form>
        <% } else { %>
            <p class="login-notice">
                Please <a href="/account/login">login</a> to leave a review.
            </p>
        <% } %>
    </section>
</div>